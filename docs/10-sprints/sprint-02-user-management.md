# üë• Sprint 2: User Management & Profile

**Version:** 1.2.0  
**Date:** 28 Desember 2025  
**Duration:** 1 week  
**Status:** ‚úÖ Completed

## üìã Sprint Goals

Implementasi complete user management system untuk Admin/Manager dan self-service profile management untuk semua users.

---

## ‚ú® Features Implemented

### 1. User Management (Admin)

#### User List & Table
- **Responsive Table** dengan mobile-optimized layout
- **Pagination** dengan configurable page size (default: 20)
- **Search** by NIP atau Full Name (debounced 300ms)
- **Filters** by Role, Department, Status
- **Sorting** by Name, NIP, Email, Created Date
- **Bulk Actions** (bulk delete, bulk update status)

#### CRUD Operations
- **Create User** dengan auto-generated password
  - 12 characters strong password
  - Password requirements: 1 uppercase, 1 lowercase, 1 digit, 1 special char
  - Display generated password dengan copy button
- **Edit User** untuk all fields (Admin/Manager only)
- **Delete User** dengan soft delete dan confirmation modal
- **View User Detail** dengan complete information

#### User Form Modal
- **Slide-up Animation** (iOS-style)
- **Field Validation** (frontend & backend)
- **Auto-generated Password** untuk new users
- **Password Copy** functionality
- **Role Selection** dengan department-specific roles
- **Department & Shift** selection

### 2. Profile Management (Self-Service)

#### Profile View
- **Complete User Information** display
- **Role Badge** dengan color coding
- **Department & Shift** information
- **Account Status** indicator
- **Creation Date** display

#### Profile Edit
- **Self-Service Updates** untuk:
  - Full Name
  - Email
  - Phone Number
- **Read-Only Fields:**
  - NIP (generated by system)
  - Role (managed by Admin)
  - Department (managed by Admin)
  - Shift (managed by Admin)
- **Success Flow** dengan auto-redirect
- **Validation** untuk email format, phone number

---

## üé® New Components

### 1. UserFormModal.vue
```vue
Features:
- Create/Edit mode
- Field validation
- Password generation & copy
- Slide-up animation
- Loading states
- Error handling
```

### 2. RoleBadge.vue
```vue
Features:
- Color-coded badges
- Role icons
- Responsive sizing
- Hover effects
```

### 3. UserTable.vue
```vue
Features:
- Responsive layout
- Sortable columns
- Action buttons (edit, delete)
- Selection checkboxes
- Empty state
```

---

## üîå API Endpoints

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/users` | List users dengan filters | Yes | Admin, Manager |
| GET | `/api/users/search` | Search users | Yes | Admin, Manager |
| GET | `/api/users/:id` | Get user detail | Yes | Admin, Manager |
| POST | `/api/users` | Create user | Yes | Admin |
| PUT | `/api/users/:id` | Update user | Yes | Admin |
| DELETE | `/api/users/:id` | Delete user | Yes | Admin |
| POST | `/api/users/bulk-delete` | Bulk delete | Yes | Admin |
| POST | `/api/users/bulk-update-status` | Bulk update status | Yes | Admin |
| GET | `/api/profile` | Get own profile | Yes | All |
| PUT | `/api/profile` | Update own profile | Yes | All |

---

## üíæ Backend Services

### UserService Methods

```go
type UserService struct {
    db *gorm.DB
}

// User Management
func (s *UserService) GetAllUsers(page, limit int, filters map[string]string) ([]User, int64, error)
func (s *UserService) GetUserByID(id int) (*User, error)
func (s *UserService) GetUserByNIP(nip string) (*User, error)
func (s *UserService) GetUserByEmail(email string) (*User, error)
func (s *UserService) CreateUser(user *User) error
func (s *UserService) UpdateUser(id int, updates map[string]interface{}) error
func (s *UserService) DeleteUser(id int) error
func (s *UserService) SearchUsers(query string) ([]User, error)

// Profile Management
func (s *UserService) UpdateProfile(userID int, updates map[string]interface{}) error

// Bulk Operations
func (s *UserService) BulkDeleteUsers(ids []int) error
func (s *UserService) BulkUpdateStatus(ids []int, status bool) error
```

### Password Generation

```go
func GenerateSecurePassword(length int) string {
    // Generates password with:
    // - At least 1 uppercase letter
    // - At least 1 lowercase letter
    // - At least 1 digit
    // - At least 1 special character
    // - Total length: 12 characters
}
```

---

## üóÑÔ∏è Database Changes

### Updated Users Table

```sql
ALTER TABLE users ADD COLUMN department ENUM('ADMIN', 'KHAZWAL', 'KEUANGAN', 'DISTRIBUSI');
ALTER TABLE users ADD COLUMN shift ENUM('PAGI', 'SORE', 'MALAM');
ALTER TABLE users ADD COLUMN phone VARCHAR(20);
ALTER TABLE users ADD COLUMN is_active BOOLEAN DEFAULT TRUE;
ALTER TABLE users ADD COLUMN deleted_at TIMESTAMP NULL;
```

### Activity Logs Enhancement

```sql
-- Activity logging otomatis via middleware
-- Tracks: CREATE, UPDATE, DELETE operations
-- Stores: before/after values dalam JSON
```

---

## üì± Frontend Implementation

### Pinia Stores

```javascript
// stores/users.js
export const useUsersStore = defineStore('users', {
  state: () => ({
    users: [],
    currentUser: null,
    pagination: {
      page: 1,
      limit: 20,
      total: 0
    },
    filters: {
      role: null,
      department: null,
      status: null,
      search: ''
    }
  }),
  
  actions: {
    async fetchUsers() { ... },
    async createUser(userData) { ... },
    async updateUser(id, updates) { ... },
    async deleteUser(id) { ... },
    async bulkDelete(ids) { ... }
  }
})
```

### Composables

```javascript
// composables/useUserForm.js
export function useUserForm() {
  const form = reactive({
    nip: '',
    full_name: '',
    email: '',
    role: '',
    department: '',
    shift: '',
    phone: ''
  })
  
  const validate = () => { ... }
  const reset = () => { ... }
  
  return { form, validate, reset }
}
```

---

## üé® UI/UX Enhancements

### Search & Filters
- **Debounced Search** (300ms delay)
- **Multi-Select Filters** (role, department, status)
- **Clear Filters** button
- **Active Filter Indicators**

### Table Features
- **Sticky Header** on scroll
- **Hover Row Highlight**
- **Action Button Group** (edit, delete)
- **Empty State** dengan illustration
- **Loading State** dengan skeleton

### Modal Interactions
- **Slide-Up Animation** (iOS-style)
- **Backdrop Click** to close
- **Escape Key** support
- **Focus Trap** dalam modal
- **Success Feedback** setelah submit

---

## üß™ Testing

### Test Scenarios

‚úÖ **User List**
- Display all users dengan pagination
- Search by NIP/name works
- Filters apply correctly
- Pagination works
- Empty state ketika no users

‚úÖ **Create User**
- Form validation works
- Auto-generated password secure
- Password copy to clipboard works
- Success message shows
- User appears in list

‚úÖ **Edit User**
- Load existing data
- Update works correctly
- Validation applies
- Changes reflect in list

‚úÖ **Delete User**
- Confirmation modal shows
- Soft delete works
- User removed from list
- Activity log created

‚úÖ **Profile Management**
- View profile shows all data
- Edit profile works
- Read-only fields cannot be edited
- Success redirect works

‚úÖ **Bulk Operations**
- Select multiple users
- Bulk delete works
- Bulk status update works
- Confirmation required

---

## üîê Security & Authorization

### Role-Based Access
- **Admin:** Full CRUD access
- **Manager:** Read + limited edit access
- **Staff:** Profile view/edit only

### Middleware Protection
```go
// Admin only
router.POST("/api/users", middleware.RequireRole("ADMIN"), handler.CreateUser)

// Admin + Manager
router.GET("/api/users", middleware.RequireRole("ADMIN", "MANAGER"), handler.ListUsers)

// All authenticated
router.GET("/api/profile", middleware.AuthMiddleware(), handler.GetProfile)
```

### Input Validation
- Email format validation
- NIP uniqueness check
- Phone number format
- Password strength requirements

---

## üìä Sprint Metrics

### Development Stats
- **API Endpoints:** 10 new endpoints
- **Components:** 5 new Vue components
- **Services:** 1 comprehensive UserService
- **Database Migrations:** 1 migration
- **Test Scenarios:** 15+ scenarios

### Performance
- **Page Load:** < 1s dengan 100 users
- **Search Response:** < 200ms
- **Pagination:** Client-side smooth scrolling
- **Debounced Search:** 300ms delay

---

## üîÑ Lessons Learned

### What Went Well ‚úÖ
- Service pattern scalable untuk CRUD operations
- Debounced search mengurangi API calls significantly
- Auto-generated password mengurangi security risks
- Activity logging via middleware efficient

### Challenges üéØ
- Bulk operations membutuhkan transaction handling
- Filter combinations butuh careful query building
- Mobile table layout butuh creative solutions

### Improvements for Next Sprint üí°
- Add export users to CSV
- Add import users from CSV
- Implement advanced filtering (date ranges, etc.)
- Add user profile photo upload

---

## üìö Documentation

### Files Updated
- API documentation updated (10 new endpoints)
- User guide created
- Admin guide created
- Testing scenarios documented

---

## üéØ Next Steps (Sprint 3)

1. **Password Management**
   - Change password flow
   - Forgot password flow
   - Reset password flow
   - Password strength indicator

2. **Security Enhancements**
   - Password policy enforcement
   - Token security improvements
   - Session management

3. **Profile Enhancements**
   - Profile photo upload
   - Additional profile fields
   - Profile completion tracking

---

## üìû Support

**Developer:** Zulfikar Hidayatullah  
**Phone:** +62 857-1583-8733  
**Sprint Lead:** Zulfikar Hidayatullah

---

## üîó Related Documentation

- [API Documentation](../03-development/api-documentation.md)
- [User Management Testing](../06-testing/user-management-testing.md)
- [Database Models](../05-guides/database/models.md)
- [Authorization Guide](../05-guides/authentication/implementation.md)

---

**Sprint Status:** ‚úÖ Completed  
**Previous Sprint:** [Sprint 1: Authentication](./sprint-01-authentication.md)  
**Next Sprint:** [Sprint 3: Password Management](./sprint-03-password-management.md)  
**Last Updated:** 29 Desember 2025
